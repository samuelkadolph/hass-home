master_bedroom_close_shades:
  alias: Master Bedroom - Close Shades
  icon: mdi:roller-shade-closed
  mode: single
  sequence:
  - parallel:
    - if:
      - '{{ is_state("binary_sensor.master_bedroom_window_a_sensor_window_door_is_open", "off") }}'
      then:
      - action: cover.close_cover
        target: { entity_id: cover.master_bedroom_shade_a }
    - if:
      - '{{ is_state("binary_sensor.master_bedroom_window_b_sensor_window_door_is_open", "off") }}'
      then:
      - action: cover.close_cover
        target: { entity_id: cover.master_bedroom_shade_b }

master_bedroom_set_shades:
  alias: Master Bedroom - Set Shades
  icon: mdi:roller-shade-closed
  mode: single
  fields:
    position:
      name: Position
      description: Target position.
      required: true
      selector: { number: { min: 0, max: 100 } }
  sequence:
  - parallel:
    - if:
      - '{{ is_state("binary_sensor.master_bedroom_window_a_sensor_window_door_is_open", "off") }}'
      then:
      - action: cover.set_cover_position
        data: { position: '{{ position }}' }
        target: { entity_id: cover.master_bedroom_shade_a }
    - if:
      - '{{ is_state("binary_sensor.master_bedroom_window_b_sensor_window_door_is_open", "off") }}'
      then:
      - action: cover.set_cover_position
        data: { position: '{{ position }}' }
        target: { entity_id: cover.master_bedroom_shade_b }

master_bedroom_turn_off:
  alias: Master Bedroom - Turn Off
  icon: mdi:power-off
  mode: single
  sequence:
  - parallel:
    - action: script.midea_turn_off
      data: { target: { entity_id: climate.master_bedroom_air } }
    - action: homeassistant.turn_off
      target:
        entity_id:
        - fan.master_bedroom_fan

master_bedroom_turn_on:
  alias: Master Bedroom - Turn On
  icon: mdi:power-on
  mode: single
  sequence:
  - parallel: []

master_bedroom_air_day:
  alias: Master Bedroom Air - Day
  icon: mdi:sun-thermometer
  mode: single
  sequence:
  - parallel:
    - if:
      - '{{ not is_state("climate.master_bedroom_air", "off") }}'
      - '{{ state_attr("climate.master_bedroom_air", "temperature") < float(states("input_number.master_bedroom_air_day_temperature")) }}'
      then:
      - action: weather.get_forecasts
        data: { type: hourly }
        target: { entity_id: weather.home }
        response_variable: forecast
      - if:
        - '{{ forecast["weather.home"].forecast[:24] | map(attribute="temperature") | max >= float(states("input_number.master_bedroom_air_day_threshold")) }}'
        then:
        - action: script.midea_set_temperature
          data:
            data:
              hvac_mode: cool
              temperature: '{{ states("input_number.master_bedroom_air_day_temperature") }}'
            target: { entity_id: climate.master_bedroom_air }
        else:
        - action: script.midea_turn_off
          data: { target: { entity_id: climate.master_bedroom_air } }
    - action: script.master_bathroom_toilet_enable_motion

master_bedroom_air_night:
  alias: Master Bedroom Air - Night
  icon: mdi:snowflake-thermometer
  mode: single
  sequence:
  - parallel:
    - if:
      - '{{ is_state("input_boolean.master_bedroom_air_night", "on") }}'
      - '{{ is_state("person.samuel_kadolph", "home") }}'
      - '{{ is_state("climate.master_bedroom_air", "off") or state_attr("climate.master_bedroom_air", "temperature") > float(states("input_number.master_bedroom_air_night_temperature")) }}'
      then:
      - parallel:
        - action: script.midea_set_temperature
          data:
            data:
              hvac_mode: cool
              temperature: '{{ states("input_number.master_bedroom_air_night_temperature") }}'
            target: { entity_id: climate.master_bedroom_air }
        - action: fan.turn_on
          target: { entity_id: fan.master_bedroom_fan }
        - if:
          - '{{ is_state("input_boolean.master_bedroom_air_night_bed_heat", "on") }}'
          - '{{ is_state("person.sasha_keller", "home") }}'
          - '{{ is_state("switch.master_bed_switch_b", "off") }}'
          then:
          - action: select.select_option
            data: { option: '{{ int(states("input_number.master_bedroom_air_night_bed_heat")) }}' }
            target: { entity_id: select.master_bed_level_b }
    - action: script.master_bathroom_toilet_disable_motion
